<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bruno's Calculator</title>
    <!-- Zahrnutie knižníc pre export do PDF a Excelu -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.15/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 10px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: auto;
            background: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .autor-info {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 14px;
            font-style: italic;
            color: #666;
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(90deg, #ff0000, #00ff00, #0000ff, #ffff00, #ff00ff);
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
            animation: gradientText 5s ease-in-out infinite, textShadowPulse 2s ease-in-out infinite;
            margin-bottom: 10px;
        }
        h2 {
            text-align: center;
            color: #555;
            margin-top: -10px;
            font-size: 1.2em;
        }
        .settings {
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-items: center;
        }
        .settings > div {
            flex: 1 1 200px;
            margin: 5px;
        }
        .settings label {
            display: block;
            margin-bottom: 5px;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            min-width: 800px;
        }
        th, td {
            padding: 8px;
            border: 1px solid #ddd;
            text-align: left;
            font-size: 0.9em;
        }
        th {
            background-color: #f2f2f2;
        }
        th:nth-child(6), td:nth-child(6),
        th:nth-child(7), td:nth-child(7) {
            width: 25%;
        }
        th:nth-child(1), td:nth-child(1),
        th:nth-child(2), td:nth-child(2),
        th:nth-child(3), td:nth-child(3),
        th:nth-child(4), td:nth-child(4),
        th:nth-child(5), td:nth-child(5),
        th:nth-child(8), td:nth-child(8) {
            width: 8.33%;
        }
        input[type="tel"], input[type="number"], input[type="text"] {
            width: 100%;
            padding: 5px;
            box-sizing: border-box;
            background-color: #ffffd0;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        .result {
            font-weight: bold;
            margin-top: 20px;
            text-align: center;
        }
        .btn-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            margin-top: 20px;
        }
        .btn {
            flex: 1 1 150px;
            padding: 10px 20px;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background-color 0.3s ease;
        }
        .reset-btn {
            background-color: #f44336;
        }
        .reset-btn:hover {
            background-color: #d32f2f;
        }
        .export-btn {
            background-color: #4CAF50;
        }
        .export-btn:hover {
            background-color: #388e3c;
        }
        .highlight {
            background-color: #ffcc00;
            color: #333;
            font-weight: bold;
            border: 2px solid #ffcc00;
        }
        #totalSalary {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background-color: #e6f3ff;
            border-radius: 5px;
        }
        #dataSizeContainer {
            margin-top: 10px;
            text-align: center;
        }
        #dataSizeText {
            margin-bottom: 5px;
            font-size: 14px;
            color: #555;
        }
        #dataSizeBar {
            width: 80%;
            height: 20px;
            background-color: #ddd;
            border-radius: 10px;
            margin: 0 auto;
            overflow: hidden;
        }
        #dataSizeFill {
            height: 100%;
            width: 0%;
            background-color: #4CAF50;
            transition: width 0.3s ease;
        }
        .current-day {
            background-color: #8a2be2;
            color: white;
        }
        .current-day input {
            background-color: #9932cc;
            color: white;
        }
        body.dark-mode {
            background-color: #333;
            color: #f4f4f4;
        }
        .container.dark-mode {
            background-color: #444;
            color: #f4f4f4;
        }
        table.dark-mode {
            background-color: #555;
            color: #f4f4f4;
        }
        th.dark-mode {
            background-color: #666;
        }
        td.dark-mode {
            background-color: #444;
            color: #f4f4f4;
        }
        input[type="tel"].dark-mode, input[type="number"].dark-mode, input[type="text"].dark-mode {
            background-color: #666;
            color: white;
        }
        .btn.dark-mode {
            color: #333;
        }
        .reset-btn.dark-mode {
            background-color: #d32f2f;
        }
        .export-btn.dark-mode {
            background-color: #388e3c;
        }
        #totalSalary.dark-mode {
            background-color: #2c3e50;
        }
        .current-day.dark-mode {
            background-color: #4a0e8f;
            color: #fff;
        }
        .current-day.dark-mode input {
            background-color: #5c1db3;
            color: #fff;
        }
        body.dark-mode .autor-info {
            color: #aaa;
        }
        @keyframes gradientText {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes textShadowPulse {
            0%, 100% {
                text-shadow: 0 0 10px rgba(255, 255, 255, 0.5), 
                             0 0 20px rgba(255, 255, 255, 0.3), 
                             0 0 30px rgba(255, 255, 255, 0.2);
            }
            50% {
                text-shadow: 0 0 20px rgba(255, 255, 255, 1), 
                             0 0 30px rgba(255, 255, 255, 0.9), 
                             0 0 40px rgba(255, 255, 255, 0.7);
            }
        }
        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 1.8em;
            }
            h2 {
                font-size: 1em;
            }
            .settings {
                flex-direction: column;
                align-items: stretch;
            }
            .settings > div {
                flex: 1 1 auto;
                margin: 10px 0;
            }
            table {
                min-width: 800px;
            }
            th, td {
                padding: 6px;
                font-size: 0.8em;
            }
            .btn-container {
                flex-direction: column;
                align-items: stretch;
            }
            .btn {
                flex: 1 1 auto;
                font-size: 14px;
                padding: 8px 16px;
                margin: 5px 0;
            }
            #totalSalary {
                font-size: 16px;
            }
            #dataSizeContainer {
                font-size: 12px;
            }
            .table-container {
                overflow-x: auto;
            }
        }
        @media (max-width: 480px) {
            h1 {
                font-size: 1.5em;
            }
            th, td {
                font-size: 0.7em;
            }
            .btn {
                font-size: 12px;
                padding: 6px 12px;
            }
            .settings label {
                font-size: 0.9em;
            }
            input[type="tel"], input[type="number"], input[type="text"] {
                font-size: 12px;
            }
            table {
                min-width: 800px;
            }
        }
        #saveNotification {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            font-size: 14px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        #saveNotification.show {
            display: block;
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="autor-info">Vytvoril a financoval Bruno</div>
        <h1 id="mainTitle">Bruno's Calculator</h1>
        <h2></h2>
        <div class="settings">
            <!-- Nové vstupné pole pre meno pracovníka -->
            <div>
                <label for="employeeNameInput">Meno pracovníka: </label>
                <input type="text" id="employeeNameInput" placeholder="Zadajte meno pracovníka" oninput="updateEmployeeName()">
            </div>
            <div>
                <label for="hourlyWageInput">Hodinová mzda (€): </label>
                <input type="number" id="hourlyWageInput" value="10" min="0" step="0.1" oninput="updateSettings()">
            </div>
            <div>
                <label for="taxRateInput">Daňové percento (%): </label>
                <input type="number" id="taxRateInput" value="2" min="0" step="0.1" oninput="updateSettings()">
            </div>
            <div>
                <label for="monthSelect">Mesiac: </label>
                <select id="monthSelect" onchange="changeMonth()">
                    <option value="0">Január</option>
                    <option value="1">Február</option>
                    <option value="2">Marec</option>
                    <option value="3">Apríl</option>
                    <option value="4">Máj</option>
                    <option value="5">Jún</option>
                    <option value="6">Júl</option>
                    <option value="7">August</option>
                    <option value="8">September</option>
                    <option value="9">Október</option>
                    <option value="10">November</option>
                    <option value="11">December</option>
                </select>
            </div>
            <!-- Pridaný výber roka -->
            <div>
                <label for="yearSelect">Rok: </label>
                <select id="yearSelect" onchange="changeYear()">
                    <!-- Dynamicky generované roky -->
                </select>
            </div>
            <!-- Nový výber počtu desatinných miest -->
            <div>
                <label for="decimalPlacesSelect">Počet desatinných miest: </label>
                <select id="decimalPlacesSelect" onchange="changeDecimalPlaces()">
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
            </div>
            <button onclick="toggleDarkMode()" class="btn highlight">Prepínať tmavý režim</button>
        </div>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Deň</th>
                        <th>Príchod</th>
                        <th>Odchod</th>
                        <th>Prestávka</th>
                        <th>Odpracované</th>
                        <th>Hrubá Mzda (€)</th>
                        <th>Čistá Mzda (€)</th>
                        <th>Akcia</th>
                    </tr>
                </thead>
                <tbody id="workDays">
                    <!-- Riadky budú pridané cez JavaScript -->
                </tbody>
            </table>
        </div>
        <div id="totalSalary"></div>
        <!-- Nový kontajner na zobrazenie veľkosti dát a progress bar -->
        <div id="dataSizeContainer">
            <div id="dataSizeText">Veľkosť dát: 0 KB / 4096 KB</div>
            <div id="dataSizeBar">
                <div id="dataSizeFill"></div>
            </div>
        </div>
        <div class="btn-container">
            <button class="btn reset-btn" onclick="resetAll()">Resetovať všetko</button>
            <button class="btn export-btn" onclick="exportToPDF()">Exportovať do PDF</button>
            <button class="btn export-btn" onclick="exportToExcel()">Exportovať do Excelu</button>
            <button class="btn export-btn" onclick="sendPDF()">Odoslať PDF</button>
            <button class="btn export-btn" onclick="importFromExcel()">Importovať z Excelu</button>
        </div>
    </div>

    <!-- Pridanie div pre notifikáciu -->
    <div id="saveNotification">Dáta boli úspešne uložené</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const workDays = document.getElementById('workDays');
            const totalSalaryDiv = document.getElementById('totalSalary');
            const dataSizeContainer = document.getElementById('dataSizeContainer');
            const dataSizeText = document.getElementById('dataSizeText');
            const dataSizeFill = document.getElementById('dataSizeFill');
            const mainTitle = document.getElementById('mainTitle');
            const hourlyWageInput = document.getElementById('hourlyWageInput');
            const taxRateInput = document.getElementById('taxRateInput');
            const monthSelect = document.getElementById('monthSelect');
            const yearSelect = document.getElementById('yearSelect');
            const decimalPlacesSelect = document.getElementById('decimalPlacesSelect');
            const employeeNameInput = document.getElementById('employeeNameInput');

            // Definujte maximálnu veľkosť dát v bajtoch (napr. 4 MB)
            const MAX_DATA_SIZE = 4 * 1024 * 1024; // 4 MB
            const MAX_DATA_SIZE_KB = MAX_DATA_SIZE / 1024; // 4096 KB

            // Inicializácia aktuálneho dátumu
            const currentDate = new Date();
            let currentMonth = currentDate.getMonth();
            let currentYear = currentDate.getFullYear();

            // Dynamické pridanie možností roka (napr. od 2020 do 2030)
            function populateYearSelect() {
                const startYear = 2020;
                const endYear = 2030;
                for (let year = startYear; year <= endYear; year++) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                }
            }

            populateYearSelect();

            // Nastavenie výberu mesiaca a roka na aktuálny mesiac a rok
            monthSelect.value = currentMonth;
            yearSelect.value = currentYear;

            // Inicializácia počtu desatinných miest
            let decimalPlaces = parseInt(localStorage.getItem('decimalPlaces')) || 1;
            decimalPlacesSelect.value = decimalPlaces;

            // Inicializácia mena pracovníka
            let employeeName = localStorage.getItem('employeeName') || '';
            employeeNameInput.value = employeeName;

            // Inicializácia mzdy a daňového percenta
            let hourlyWage = parseFloat(hourlyWageInput.value);
            let taxRate = parseFloat(taxRateInput.value) / 100;
            let monthData = {};

            console.log(`Inicializácia: Mesiac=${currentMonth}, Rok=${currentYear}, Desatinné miesta=${decimalPlaces}, Meno=${employeeName}`);

            // Debounce funkcia na optimalizáciu ukladania do localStorage
            function debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            }

            const debouncedSaveToLocalStorage = debounce(saveToLocalStorage, 300);

            // Funkcia na zobrazenie notifikácie
            function showSaveNotification() {
                const notification = document.getElementById('saveNotification');
                notification.classList.add('show');
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 2000);
            }

            // Funkcia na uloženie dát do localStorage
            function saveToLocalStorage() {
                try {
                    console.log(`Ukladanie dát pre Rok=${currentYear}, Mesiac=${currentMonth}`);
                    const data = [];
                    for (let i = 1; i <= getDaysInMonth(currentMonth); i++) {
                        const startElement = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`);
                        const endElement = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`);
                        const breakElement = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`);
                        const grossElement = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`);
                        const netElement = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`);

                        const start = startElement ? startElement.value : '';
                        const end = endElement ? endElement.value : '';
                        const breakTime = breakElement ? breakElement.value : '';
                        const gross = grossElement ? grossElement.value : '0.00';
                        const net = netElement ? netElement.value : '0.00';

                        data.push({ start, end, breakTime, gross, net });
                    }
                    if (!monthData[currentYear]) {
                        monthData[currentYear] = {};
                    }
                    monthData[currentYear][currentMonth] = data;

                    const serializedData = JSON.stringify(monthData);
                    const serializedHourlyWage = JSON.stringify(hourlyWage);
                    const serializedTaxRate = JSON.stringify(taxRate);
                    const serializedDarkMode = JSON.stringify(document.body.classList.contains('dark-mode'));
                    const serializedDecimalPlaces = JSON.stringify(decimalPlaces);
                    const serializedEmployeeName = JSON.stringify(employeeName);

                    const totalData = serializedData + serializedHourlyWage + serializedTaxRate + serializedDarkMode + serializedDecimalPlaces + serializedEmployeeName;
                    const bytes = new Blob([totalData]).size;

                    console.log(`Celková veľkosť dát: ${bytes} bajtov`);

                    if (bytes > MAX_DATA_SIZE) {
                        alert(`Prekročili ste maximálnu veľkosť dát (${(MAX_DATA_SIZE_KB).toFixed(2)} KB). Dáta neboli uložené.`);
                        return;
                    }

                    localStorage.setItem('workDaysData', serializedData);
                    localStorage.setItem('hourlyWage', serializedHourlyWage);
                    localStorage.setItem('taxRate', serializedTaxRate);
                    localStorage.setItem('darkMode', serializedDarkMode);
                    localStorage.setItem('decimalPlaces', serializedDecimalPlaces);
                    localStorage.setItem('employeeName', serializedEmployeeName);
                    console.log('Dáta uložené do localStorage:', monthData);
                    updateDataSize();

                    showSaveNotification();
                } catch (error) {
                    console.error('Chyba pri ukladaní do localStorage:', error);
                }
            }

            // Funkcia na načítanie dát z localStorage
            function loadFromLocalStorage() {
                try {
                    console.log(`Načítanie dát pre Rok=${currentYear}, Mesiac=${currentMonth}`);
                    const storedData = JSON.parse(localStorage.getItem('workDaysData')) || {};
                    monthData = storedData;
                    const storedHourlyWage = parseFloat(JSON.parse(localStorage.getItem('hourlyWage')));
                    const storedTaxRate = parseFloat(JSON.parse(localStorage.getItem('taxRate')));
                    const storedDarkMode = JSON.parse(localStorage.getItem('darkMode'));
                    const storedDecimalPlaces = parseInt(JSON.parse(localStorage.getItem('decimalPlaces'))) || 1;
                    const storedEmployeeName = JSON.parse(localStorage.getItem('employeeName')) || '';

                    decimalPlaces = storedDecimalPlaces;
                    decimalPlacesSelect.value = decimalPlaces;

                    employeeName = storedEmployeeName;
                    employeeNameInput.value = employeeName;

                    if (!isNaN(storedHourlyWage)) {
                        hourlyWage = storedHourlyWage;
                        hourlyWageInput.value = hourlyWage;
                        console.log(`Nastavená hodinová mzda: ${hourlyWage}`);
                    }
                    if (!isNaN(storedTaxRate)) {
                        taxRate = storedTaxRate;
                        taxRateInput.value = (taxRate * 100).toFixed(1);
                        console.log(`Nastavený daňový percento: ${taxRate * 100}%`);
                    }

                    const data = (monthData[currentYear] && monthData[currentYear][currentMonth]) || [];
                    console.log(`Načítané dáta pre aktuálny mesiac:`, data);
                    data.forEach((day, index) => {
                        const i = index + 1;
                        const startElement = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`);
                        const endElement = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`);
                        const breakElement = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`);
                        const grossElement = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`);
                        const netElement = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`);

                        if (startElement && endElement && breakElement && grossElement && netElement) {
                            startElement.value = day.start || '';
                            endElement.value = day.end || '';
                            breakElement.value = day.breakTime || '';
                            grossElement.value = day.gross || '0.00';
                            netElement.value = day.net || '0.00';
                            calculateRow(i);
                            console.log(`Deň ${i}:`, day);
                        } else {
                            console.warn(`Chýbajúci element pre deň ${i}`);
                        }
                    });
                    calculateTotal();
                    updateDataSize();

                    if (storedDarkMode) {
                        document.body.classList.add('dark-mode');
                        document.querySelector('.container').classList.add('dark-mode');
                        document.querySelectorAll('table, th, td, input').forEach(element => {
                            element.classList.add('dark-mode');
                        });
                        document.querySelectorAll('.btn').forEach(button => {
                            button.classList.add('dark-mode');
                        });
                        totalSalaryDiv.classList.add('dark-mode');
                        mainTitle.classList.add('dark-mode');
                        document.querySelector('.autor-info').classList.add('dark-mode');

                        const currentDayRow = document.querySelector('.current-day');
                        if (currentDayRow) {
                            currentDayRow.classList.add('dark-mode');
                        }
                        console.log('Tmavý režim aktivovaný');
                    }
                } catch (error) {
                    console.error('Chyba pri načítavaní z localStorage:', error);
                }
            }

            // Funkcia na získanie názvu dňa v týždni
            function getDayName(year, month, day) {
                const daysOfWeek = ["Nedeľa", "Pondelok", "Utorok", "Streda", "Štvrtok", "Piatok", "Sobota"];
                const date = new Date(year, month, day);
                return daysOfWeek[date.getDay()];
            }

            // Funkcia na vytvorenie tabuľky pre aktuálny mesiac a rok
            function createTable() {
                workDays.innerHTML = '';
                console.log(`Vytváranie tabuľky pre Rok=${currentYear}, Mesiac=${currentMonth}`);

                const currentDay = new Date().getDate();
                const currentMonthIndex = new Date().getMonth();
                const currentYearValue = new Date().getFullYear();
                const daysInMonth = getDaysInMonth(currentMonth);

                for (let i = 1; i <= daysInMonth; i++) {
                    const row = document.createElement('tr');
                    if (i === currentDay && currentMonth === currentMonthIndex && currentYear === currentYearValue) {
                        row.classList.add('current-day');
                        console.log(`Aktuálny deň ${i} zvýraznený`);
                    }

                    const dayName = getDayName(currentYear, currentMonth, i);

                    row.innerHTML = `
                        <td>Deň ${i} (${dayName})</td>
                        <td><input type="tel" id="start-${currentYear}-${currentMonth}-${i}" maxlength="5" pattern="[0-9:]*" inputmode="numeric" placeholder="HH:MM" oninput="handleInput(this, 'end-${currentYear}-${currentMonth}-${i}')"></td>
                        <td><input type="tel" id="end-${currentYear}-${currentMonth}-${i}" maxlength="5" pattern="[0-9:]*" inputmode="numeric" placeholder="HH:MM" oninput="handleInput(this, 'break-${currentYear}-${currentMonth}-${i}')"></td>
                        <td><input type="number" id="break-${currentYear}-${currentMonth}-${i}" min="0" step="0.5" placeholder="prestávka" oninput="handleBreakInput(${i})"></td>
                        <td id="total-${currentYear}-${currentMonth}-${i}">0h 0m (${(0).toFixed(decimalPlaces)} h)</td>
                        <td><input type="number" id="gross-${currentYear}-${currentMonth}-${i}" min="0" step="0.01" placeholder="Hrubá Mzda" oninput="handleGrossInput(${i})" readonly></td>
                        <td><input type="number" id="net-${currentYear}-${currentMonth}-${i}" min="0" step="0.01" placeholder="Čistá Mzda" readonly></td>
                        <td><button class="btn reset-btn" onclick="resetRow(${i})">Vynulovať</button></td>
                    `;
                    workDays.appendChild(row);
                }

                loadFromLocalStorage();
            }

            // Funkcia na spracovanie vstupu času
            window.handleInput = function(input, nextId) {
                formatAndMoveNext(input, nextId);
                calculateAndUpdateTotals();
            }

            // Funkcia na spracovanie vstupu prestávky
            window.handleBreakInput = function(day) {
                calculateRow(day);
                const nextDay = day + 1;
                if (nextDay <= getDaysInMonth(currentMonth)) {
                    moveNext(document.getElementById(`break-${currentYear}-${currentMonth}-${day}`), `start-${currentYear}-${currentMonth}-${nextDay}`);
                }
                calculateAndUpdateTotals();
            }

            // Funkcia na spracovanie hrubej mzdy
            window.handleGrossInput = function(day) {
                updateNetSalary(day);
                calculateAndUpdateTotals();
            }

            // Funkcia na výpočet a aktualizáciu súčtov
            function calculateAndUpdateTotals() {
                calculateTotal();
                debouncedSaveToLocalStorage();
            }

            // Funkcia na formátovanie času a presun na ďalšie pole
            function formatAndMoveNext(input, nextId) {
                let value = input.value.replace(/[^\d:]/g, '');
                if (value.length === 4 && !value.includes(':')) {
                    value = value.slice(0, 2) + ':' + value.slice(2);
                }
                input.value = value;

                const day = parseInt(input.id.split('-')[3]);
                calculateRow(day);

                if (value.length === 5) {
                    const [hours, minutes] = value.split(':').map(Number);
                    if (hours >= 0 && hours < 24 && minutes >= 0 && minutes < 60) {
                        moveNext(input, nextId);
                    } else {
                        alert("Neplatný čas. Prosím, zadajte čas vo formáte HH:MM (napr. 06:30 pre 6:30).");
                        input.value = '';
                    }
                }
            }

            // Funkcia na presun focusu na ďalšie pole
            function moveNext(currentElement, nextId) {
                const nextElement = document.getElementById(nextId);
                if (nextElement) {
                    nextElement.focus();
                }
            }

            // Funkcia na výpočet odpracovaného času a mzdy pre jeden deň
            function calculateRow(day) {
                const startTime = document.getElementById(`start-${currentYear}-${currentMonth}-${day}`).value;
                const endTime = document.getElementById(`end-${currentYear}-${currentMonth}-${day}`).value;
                const breakTime = parseFloat(document.getElementById(`break-${currentYear}-${currentMonth}-${day}`).value) || 0;

                if (startTime && endTime) {
                    const [startHours, startMinutes] = startTime.split(':').map(Number);
                    const [endHours, endMinutes] = endTime.split(':').map(Number);

                    const startDate = new Date();
                    startDate.setHours(startHours, startMinutes, 0, 0);
                    const endDate = new Date();
                    endDate.setHours(endHours, endMinutes, 0, 0);

                    let diff = (endDate - startDate) / 60000 - (breakTime * 60);

                    if (diff < 0) diff += 24 * 60;

                    const hours = Math.floor(diff / 60);
                    const minutes = Math.round(diff % 60);
                    const decimalHours = (diff / 60).toFixed(decimalPlaces);

                    const totalCell = document.getElementById(`total-${currentYear}-${currentMonth}-${day}`);
                    totalCell.textContent = `${hours}h ${minutes}m (${decimalHours} h)`;

                    const grossSalary = (diff / 60) * hourlyWage;
                    document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`).value = isFinite(grossSalary) ? grossSalary.toFixed(decimalPlaces) : '0.00';
                    updateNetSalary(day);
                }
            }

            // Funkcia na výpočet čistej mzdy
            function updateNetSalary(day) {
                const grossSalary = parseFloat(document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`).value) || 0;
                const netSalary = grossSalary * (1 - taxRate);
                document.getElementById(`net-${currentYear}-${currentMonth}-${day}`).value = isFinite(netSalary) ? netSalary.toFixed(decimalPlaces) : '0.00';
            }

            // Funkcia na resetovanie jedného riadku
            window.resetRow = function(day) {
                document.getElementById(`start-${currentYear}-${currentMonth}-${day}`).value = '';
                document.getElementById(`end-${currentYear}-${currentMonth}-${day}`).value = '';
                document.getElementById(`break-${currentYear}-${currentMonth}-${day}`).value = '';
                document.getElementById(`total-${currentYear}-${currentMonth}-${day}`).textContent = `0h 0m (${(0).toFixed(decimalPlaces)} h)`;
                document.getElementById(`gross-${currentYear}-${currentMonth}-${day}`).value = '0.00';
                document.getElementById(`net-${currentYear}-${currentMonth}-${day}`).value = '0.00';

                calculateAndUpdateTotals();
            }

            // Funkcia na resetovanie všetkých dát pre aktuálny mesiac a rok
            window.resetAll = function() {
                if (confirm('Ste si istý, že chcete resetovať dáta pre aktuálny mesiac? Táto akcia sa nedá vrátiť späť.')) {
                    if (monthData[currentYear] && monthData[currentYear][currentMonth]) {
                        delete monthData[currentYear][currentMonth];
                        console.log(`Dáta pre Rok=${currentYear}, Mesiac=${currentMonth} vymazané`);
                    }

                    localStorage.setItem('workDaysData', JSON.stringify(monthData));

                    createTable();
                    calculateTotal();
                }
            }

            // Funkcia na výpočet celkového odpracovaného času, priemeru a miezd
            function calculateTotal() {
                let totalMinutes = 0;
                let totalGrossSalary = 0;
                let totalNetSalary = 0;
                let daysWithEntries = 0;

                workDays.querySelectorAll('tr').forEach(row => {
                    const totalCell = row.children[4];
                    const grossInput = row.children[5].querySelector('input');
                    const netInput = row.children[6].querySelector('input');

                    if (totalCell && grossInput && netInput) {
                        const totalText = totalCell.textContent;
                        const match = totalText.match(/(\d+)h (\d+)m \(([\d.]+) h\)/);
                        if (match) {
                            const hours = parseInt(match[1]) || 0;
                            const minutes = parseInt(match[2]) || 0;
                            const decimalHours = parseFloat(match[3]) || 0;
                            totalMinutes += hours * 60 + minutes;

                            const grossSalary = parseFloat(grossInput.value) || 0;
                            totalGrossSalary += grossSalary;

                            const netSalary = parseFloat(netInput.value) || 0;
                            totalNetSalary += netSalary;

                            if (grossSalary > 0 || netSalary > 0) {
                                daysWithEntries += 1;
                            }
                        }
                    }
                });

                const totalHours = Math.floor(totalMinutes / 60);
                const totalMinutesRemainder = Math.round(totalMinutes % 60);
                const totalDecimalHours = (totalMinutes / 60).toFixed(decimalPlaces);

                let averageNetSalary = 0;
                if (daysWithEntries > 0) {
                    averageNetSalary = (totalNetSalary / daysWithEntries).toFixed(decimalPlaces);
                }

                let averageWorkedMinutes = 0;
                if (daysWithEntries > 0) {
                    averageWorkedMinutes = totalMinutes / daysWithEntries;
                }
                const averageHours = Math.floor(averageWorkedMinutes / 60);
                const averageMinutes = Math.round(averageWorkedMinutes % 60);
                const averageDecimalHours = (averageWorkedMinutes / 60).toFixed(decimalPlaces);

                totalSalaryDiv.innerHTML = `
                    Počet odpracovaných dní: ${daysWithEntries}<br>
                    Celkový odpracovaný čas: ${totalHours}h ${totalMinutesRemainder}m (${totalDecimalHours} h)<br>
                    Celková hrubá mzda: ${totalGrossSalary.toFixed(decimalPlaces)}€<br>
                    Celková čistá mzda: ${totalNetSalary.toFixed(decimalPlaces)}€<br>
                    Priemerná čistá mzda: ${averageNetSalary}€<br><strong>Priemerný odpracovaný čas: ${averageHours}h ${averageMinutes}m (${averageDecimalHours} h)</strong>
                `;
            }

            // Funkcia na exportovanie do PDF
            window.exportToPDF = function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Add a Unicode font that supports Slovak characters
                doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf', 'Roboto', 'normal');
                doc.setFont('Roboto');

                doc.setFontSize(18);
                doc.text(`Bruno's Calculator - Výkaz práce (${getMonthName(currentMonth)} ${currentYear})`, 14, 20);

                doc.setFontSize(14);
                doc.text(`Meno pracovníka: ${employeeName}`, 14, 25);

                const tableData = [];
                for (let i = 1; i <= getDaysInMonth(currentMonth); i++) {
                    const dayName = getDayName(currentYear, currentMonth, i);
                    const startTime = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`).value;
                    const endTime = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`).value;
                    const breakTime = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`).value;
                    const totalTime = document.getElementById(`total-${currentYear}-${currentMonth}-${i}`).textContent;
                    const grossSalary = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`).value;
                    const netSalary = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`).value;

                    if (startTime || endTime || breakTime) {
                        tableData.push([`Deň ${i} (${dayName})`, startTime, endTime, breakTime, totalTime, grossSalary, netSalary]);
                    }
                }

                doc.autoTable({
                    head: [['Deň', 'Príchod', 'Odchod', 'Prestávka', 'Odpracované', 'Hrubá Mzda (€)', 'Čistá Mzda (€)']],
                    body: tableData,
                    startY: 30,
                    styles: { font: 'Roboto' },
                    headStyles: { fillColor: [41, 128, 185], textColor: 255 },
                    alternateRowStyles: { fillColor: [245, 245, 245] },
                    margin: { top: 25 }
                });

                const totalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(12);
                doc.text(totalSalaryDiv.innerText, 14, totalY);

                doc.save(`brunos-calculator-report-${getMonthName(currentMonth)}-${currentYear}.pdf`);
            }

            // Funkcia na exportovanie do Excelu
            window.exportToExcel = function() {
                const data = [
                    [`Meno pracovníka: ${employeeName}`],
                    [],
                    ['Deň', 'Príchod', 'Odchod', 'Prestávka', 'Odpracované', 'Hrubá Mzda (€)', 'Čistá Mzda (€)']
                ];

                for (let i = 1; i <= getDaysInMonth(currentMonth); i++) {
                    const dayName = getDayName(currentYear, currentMonth, i);
                    const startTime = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`).value;
                    const endTime = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`).value;
                    const breakTime = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`).value;
                    const totalTime = document.getElementById(`total-${currentYear}-${currentMonth}-${i}`).textContent;
                    const grossSalary = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`).value;
                    const netSalary = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`).value;

                    data.push([`Deň ${i} (${dayName})`, startTime, endTime, breakTime, totalTime, grossSalary, netSalary]);
                }

                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Výkaz práce");
                XLSX.writeFile(wb, `brunos-calculator-report-${getMonthName(currentMonth)}-${currentYear}.xlsx`);
            }

            // NOVÁ FUNKCIA: Odoslanie PDF súboru pomocou Web Share API
            window.sendPDF = function() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();

                // Pridanie písma pre podporu slovenských znakov
                doc.addFont('https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.66/fonts/Roboto/Roboto-Regular.ttf', 'Roboto', 'normal');
                doc.setFont('Roboto');

                doc.setFontSize(18);
                doc.text(`Bruno's Calculator - Výkaz práce (${getMonthName(currentMonth)} ${currentYear})`, 14, 20);

                doc.setFontSize(14);
                doc.text(`Meno pracovníka: ${employeeName}`, 14, 25);

                const tableData = [];
                for (let i = 1; i <= getDaysInMonth(currentMonth); i++) {
                    const dayName = getDayName(currentYear, currentMonth, i);
                    const startTime = document.getElementById(`start-${currentYear}-${currentMonth}-${i}`).value;
                    const endTime = document.getElementById(`end-${currentYear}-${currentMonth}-${i}`).value;
                    const breakTime = document.getElementById(`break-${currentYear}-${currentMonth}-${i}`).value;
                    const totalTime = document.getElementById(`total-${currentYear}-${currentMonth}-${i}`).textContent;
                    const grossSalary = document.getElementById(`gross-${currentYear}-${currentMonth}-${i}`).value;
                    const netSalary = document.getElementById(`net-${currentYear}-${currentMonth}-${i}`).value;

                    if (startTime || endTime || breakTime) {
                        tableData.push([`Deň ${i} (${dayName})`, startTime, endTime, breakTime, totalTime, grossSalary, netSalary]);
                    }
                }

                doc.autoTable({
                    head: [['Deň', 'Príchod', 'Odchod', 'Prestávka', 'Odpracované', 'Hrubá Mzda (€)', 'Čistá Mzda (€)']],
                    body: tableData,
                    startY: 30,
                    styles: { font: 'Roboto' },
                    headStyles: { fillColor: [41, 128, 185], textColor: 255 },
                    alternateRowStyles: { fillColor: [245, 245, 245] },
                    margin: { top: 25 }
                });

                const totalY = doc.lastAutoTable.finalY + 10;
                doc.setFontSize(12);
                doc.text(totalSalaryDiv.innerText, 14, totalY);

                // Vygenerovanie Blob-u z PDF
                const pdfBlob = doc.output('blob');

                // Vytvorenie File objektu z Blob-u
                const pdfFile = new File(
                    [pdfBlob],
                    `brunos-calculator-report-${getMonthName(currentMonth)}-${currentYear}.pdf`,
                    { type: 'application/pdf' }
                );

                if (navigator.canShare && navigator.canShare({ files: [pdfFile] })) {
                    navigator.share({
                        files: [pdfFile],
                        title: `Bruno's Calculator Report`,
                        text: `Pozrite si výkaz práce za ${getMonthName(currentMonth)} ${currentYear}`
                    })
                    .then(() => console.log('PDF bolo úspešne odoslané'))
                    .catch(error => {
                        console.error('Chyba pri odosielaní PDF:', error);
                        alert('Nastala chyba pri odosielaní PDF.');
                    });
                } else {
                    alert('Funkcia zdieľania súborov nie je podporovaná vo vašom prehliadači.');
                }
            }

            // Funkcia na importovanie dát z Excelu
            window.importFromExcel = function() {
                const fileInput = document.createElement('input');
                fileInput.type = 'file';
                fileInput.accept = '.xlsx, .xls';
                fileInput.onchange = (event) => {
                    const file = event.target.files[0];
                    if (!file) {
                        return;
                    }

                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const data = new Uint8Array(e.target.result);
                            const workbook = XLSX.read(data, { type: 'array' });

                            const firstSheetName = workbook.SheetNames[0];
                            const worksheet = workbook.Sheets[firstSheetName];
                            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

                            console.log('Načítané dáta z Excelu:', jsonData);

                            if (jsonData.length < 4) {
                                alert('Excel súbor neobsahuje dostatok údajov.');
                                return;
                            }

                            const employeeNameRow = jsonData[0];
                            if (!employeeNameRow[0].startsWith('Meno pracovníka:')) {
                                alert('Excel súbor má nesprávnu štruktúru alebo chýba meno pracovníka.');
                                console.error('Nevalidné meno pracovníka:', employeeNameRow[0]);
                                return;
                            }

                            const importedEmployeeName = employeeNameRow[0].replace('Meno pracovníka: ', '').trim();
                            console.log(`Načítané meno pracovníka: ${importedEmployeeName}`);
                            employeeName = importedEmployeeName;
                            employeeNameInput.value = employeeName;

                            const headers = jsonData[2];
                            const expectedHeaders = ['Deň', 'Príchod', 'Odchod', 'Prestávka', 'Odpracované', 'Hrubá Mzda (€)', 'Čistá Mzda (€)'];
                            const isValid = expectedHeaders.every((header, index) => header === jsonData[2][index]);

                            if (!isValid) {
                                alert('Excel súbor má nesprávnu štruktúru hlavičiek.');
                                console.error('Nevalidné hlavičky:', headers);
                                return;
                            }

                            if (!monthData[currentYear]) {
                                monthData[currentYear] = {};
                            }
                            const daysInMonth = getDaysInMonth(currentMonth);
                            monthData[currentYear][currentMonth] = Array.from({ length: daysInMonth }, () => ({
                                start: '',
                                end: '',
                                breakTime: '',
                                gross: '0.00',
                                net: '0.00'
                            }));

                            for (let i = 3; i < jsonData.length; i++) {
                                const row = jsonData[i];
                                if (row.length < 7) {
                                    console.warn(`Riadenie ${i+1} má nedostatočné množstvo údajov:`, row);
                                    continue;
                                }

                                const dayInfo = row[0];
                                const dayMatch = dayInfo.match(/(?:Deň )?(\d+) \((.+)\)/);
                                if (!dayMatch) {
                                    console.warn(`Riadenie ${i+1} má neplatný formát dňa:`, dayInfo);
                                    continue;
                                }

                                const day = parseInt(dayMatch[1]);
                                if (isNaN(day) || day < 1 || day > daysInMonth) {
                                    console.warn(`Riadenie ${i+1} má neplatné číslo dňa:`, day);
                                    continue;
                                }

                                const start = row[1] || '';
                                const end = row[2] || '';
                                const breakTime = row[3] || '';
                                const gross = parseFloat(row[5]) ? parseFloat(row[5]).toFixed(decimalPlaces) : '0.00';
                                const net = parseFloat(row[6]) ? parseFloat(row[6]).toFixed(decimalPlaces) : '0.00';

                                console.log(`Priradenie dát pre deň ${day}:`, { start, end, breakTime, gross, net });

                                monthData[currentYear][currentMonth][day - 1] = { start, end, breakTime, gross, net };
                            }

                            const serializedData = JSON.stringify(monthData);
                            const serializedHourlyWage = JSON.stringify(hourlyWage);
                            const serializedTaxRate = JSON.stringify(taxRate);
                            const serializedDarkMode = JSON.stringify(document.body.classList.contains('dark-mode'));
                            const serializedDecimalPlaces = JSON.stringify(decimalPlaces);
                            const serializedEmployeeName = JSON.stringify(employeeName);

                            const totalData = serializedData + serializedHourlyWage + serializedTaxRate + serializedDarkMode + serializedDecimalPlaces + serializedEmployeeName;
                            const bytes = new Blob([totalData]).size;

                            console.log(`Celková veľkosť dát po importe: ${bytes} bajtov`);

                            if (bytes > MAX_DATA_SIZE) {
                                alert(`Prekročili ste maximálnu veľkosť dát (${(MAX_DATA_SIZE_KB).toFixed(2)} KB). Dáta neboli uložené.`);
                                console.warn('Importované dáta prekročili limit veľkosti.');
                                return;
                            }

                            localStorage.setItem('workDaysData', serializedData);
                            localStorage.setItem('hourlyWage', serializedHourlyWage);
                            localStorage.setItem('taxRate', serializedTaxRate);
                            localStorage.setItem('darkMode', serializedDarkMode);
                            localStorage.setItem('decimalPlaces', serializedDecimalPlaces);
                            localStorage.setItem('employeeName', serializedEmployeeName);
                            console.log('Dáta uložené do localStorage:', monthData);

                            createTable();
                            calculateTotal();

                            updateDataSize();

                            showSaveNotification();

                            alert('Dáta boli úspešne importované z Excelu.');
                        } catch (error) {
                            console.error('Chyba pri importe dát:', error);
                            alert('Chyba pri importe dát z Excelu.');
                        }
                    };
                    reader.readAsArrayBuffer(file);
                };
                fileInput.click();
            }

            // Funkcia na prepínanie tmavého režimu
            window.toggleDarkMode = function() {
                document.body.classList.toggle('dark-mode');
                document.querySelector('.container').classList.toggle('dark-mode');
                document.querySelectorAll('table, th, td, input').forEach(element => {
                    element.classList.toggle('dark-mode');
                });
                document.querySelectorAll('.btn').forEach(button => {
                    button.classList.toggle('dark-mode');
                });
                totalSalaryDiv.classList.toggle('dark-mode');
                mainTitle.classList.toggle('dark-mode');
                document.querySelector('.autor-info').classList.toggle('dark-mode');

                const currentDayRow = document.querySelector('.current-day');
                if (currentDayRow) {
                    currentDayRow.classList.toggle('dark-mode');
                }

                localStorage.setItem('darkMode', JSON.stringify(document.body.classList.contains('dark-mode')));
                updateDataSize();
            }

            // Funkcia na načítanie stavu tmavého režimu
            function loadDarkMode() {
                const darkMode = JSON.parse(localStorage.getItem('darkMode')) || false;
                if (darkMode) {
                    document.body.classList.add('dark-mode');
                    document.querySelector('.container').classList.add('dark-mode');
                    document.querySelectorAll('table, th, td, input').forEach(element => {
                        element.classList.add('dark-mode');
                    });
                    document.querySelectorAll('.btn').forEach(button => {
                        button.classList.add('dark-mode');
                    });
                    totalSalaryDiv.classList.add('dark-mode');
                    mainTitle.classList.add('dark-mode');
                    document.querySelector('.autor-info').classList.add('dark-mode');

                    const currentDayRow = document.querySelector('.current-day');
                    if (currentDayRow) {
                        currentDayRow.classList.add('dark-mode');
                    }
                    console.log('Tmavý režim aktivovaný');
                }
            }

            // Funkcia na zmenu počtu desatinných miest
            window.changeDecimalPlaces = function() {
                decimalPlaces = parseInt(decimalPlacesSelect.value);
                console.log(`Zmena počtu desatinných miest na: ${decimalPlaces}`);
                localStorage.setItem('decimalPlaces', JSON.stringify(decimalPlaces));
                calculateTotal();
                for (let i = 1; i <= getDaysInMonth(currentMonth); i++) {
                    calculateRow(i);
                }
            }

            // Funkcia na aktualizáciu mena pracovníka
            window.updateEmployeeName = function() {
                employeeName = employeeNameInput.value.trim();
                console.log(`Aktualizované meno pracovníka: ${employeeName}`);
                localStorage.setItem('employeeName', JSON.stringify(employeeName));
                debouncedSaveToLocalStorage();
            }

            // Funkcia na aktualizáciu nastavení mzdy a daňového percenta
            window.updateSettings = function() {
                hourlyWage = parseFloat(hourlyWageInput.value);
                taxRate = parseFloat(taxRateInput.value) / 100;
                console.log(`Aktualizované nastavenia: Hodinová mzda=${hourlyWage}, Daňové percento=${taxRate * 100}%`);

                for (let i = 1; i <= getDaysInMonth(currentMonth); i++) {
                    calculateRow(i);
                }
                calculateAndUpdateTotals();
            }

            // Funkcia na zmenu mesiaca
            window.changeMonth = function() {
                currentMonth = parseInt(monthSelect.value);
                console.log(`Zmena mesiaca: Mesiac=${currentMonth}, Rok=${currentYear}`);
                createTable();
            }

            // Funkcia na zmenu roka
            window.changeYear = function() {
                currentYear = parseInt(yearSelect.value);
                console.log(`Zmena roka: Rok=${currentYear}, Mesiac=${currentMonth}`);
                createTable();
            }

            // Funkcia na získanie počtu dní v mesiaci
            function getDaysInMonth(month) {
                return new Date(currentYear, month + 1, 0).getDate();
            }

            // Funkcia na získanie názvu mesiaca
            function getMonthName(month) {
                const monthNames = ["Január", "Február", "Marec", "Apríl", "Máj", "Jún",
                    "Júl", "August", "September", "Október", "November", "December"
                ];
                return monthNames[month];
            }

            // Funkcia na výpočet veľkosti dát v localStorage a aktualizáciu progress baru
            function updateDataSize() {
                try {
                    const workDaysData = localStorage.getItem('workDaysData') || '{}';
                    const hourlyWage = localStorage.getItem('hourlyWage') || '';
                    const taxRate = localStorage.getItem('taxRate') || '';
                    const darkMode = localStorage.getItem('darkMode') || 'false';
                    const decimalPlacesStored = localStorage.getItem('decimalPlaces') || '1';
                    const employeeNameStored = localStorage.getItem('employeeName') || '""';

                    const totalData = workDaysData + hourlyWage + taxRate + darkMode + decimalPlacesStored + employeeNameStored;
                    const bytes = new Blob([totalData]).size;
                    const kilobytes = (bytes / 1024).toFixed(2);
                    const percentageUsed = Math.min(((bytes / MAX_DATA_SIZE) * 100).toFixed(2), 100);

                    dataSizeText.textContent = `Veľkosť dát: ${kilobytes} KB / ${MAX_DATA_SIZE_KB} KB`;

                    dataSizeFill.style.width = `${percentageUsed}%`;

                    if (percentageUsed > 80) {
                        dataSizeFill.style.backgroundColor = '#f44336';
                    } else if (percentageUsed > 50) {
                        dataSizeFill.style.backgroundColor = '#ff9800';
                    } else {
                        dataSizeFill.style.backgroundColor = '#4CAF50';
                    }

                    if (bytes > MAX_DATA_SIZE) {
                        dataSizeFill.style.backgroundColor = '#f44336';
                        alert(`Aktuálna veľkosť dát (${kilobytes} KB) prekročila maximálnu povolenú veľkosť (${MAX_DATA_SIZE_KB} KB). Pokúste sa znížiť množstvo uložených dát.`);
                        console.warn('Dáta prekročili limit veľkosti.');
                    } else {
                        console.log(`Aktuálna veľkosť dát: ${kilobytes} KB (${percentageUsed}%)`);
                    }
                } catch (error) {
                    console.error('Chyba pri výpočte veľkosti dát:', error);
                    dataSizeText.textContent = `Veľkosť dát: Nepodarilo sa vypočítať`;
                }
            }

            createTable();
            calculateTotal();
            loadDarkMode();
            updateDataSize();
        });
    </script>
</body>
</html>
